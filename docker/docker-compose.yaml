services:
  ros2:
    image: ros2-turtlebot3
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ros2_turtlebot3
    privileged: true
    network_mode: host
    ipc: host
    tty: true

    command: >
      /bin/bash -c '
        if [ -z "$$GOOGLE_API_KEY" ] && [ -z "$$MISTRAL_API_KEY" ]; then
          echo "Fehler: Weder GOOGLE_API_KEY noch MISTRAL_API_KEY gesetzt!";
          exit 1;
        fi;
        echo "Verfügbare LLM APIs:";
        [ -n "$$GOOGLE_API_KEY" ] && echo "  - Google Gemini ✓";
        [ -n "$$MISTRAL_API_KEY" ] && echo "  - Mistral ✓";
        exec bash;
      '

    volumes:
      - ../ros2_ws:/home/ubuntu/ros2_ws
      - /tmp/.X11-unix:/tmp/.X11-unix:rw

    environment:
      DISPLAY: $DISPLAY
      QT_X11_NO_MITSHM: 1
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
      MISTRAL_API_KEY: ${MISTRAL_API_KEY:-}

volumes:
  ros2_ws:
    driver: local
